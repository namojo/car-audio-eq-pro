<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#000000">
    <title>Car Audio EQ Pro</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header>
            <h1>Car Audio EQ Pro</h1>
            <button id="settingsBtn" class="icon-btn" aria-label="Settings">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                </svg>
            </button>
        </header>

        <!-- Player Section -->
        <section id="player">
            <div class="album-art" id="albumArt">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                </svg>
            </div>
            <div class="track-info">
                <h2 id="trackTitle">No track selected</h2>
                <p id="trackArtist">Choose a file to play</p>
            </div>
            <div class="player-controls">
                <input type="file" id="fileInput" accept="audio/*" style="display: none;">
                <button id="chooseFileBtn" class="secondary-btn">Choose File</button>
                <button id="playPauseBtn" class="play-btn" disabled>
                    <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                    </svg>
                </button>
            </div>
            <div class="progress-container">
                <span id="currentTime">0:00</span>
                <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1">
                <span id="duration">0:00</span>
            </div>
        </section>

        <!-- Spectrum Analyzer -->
        <section id="analyzer">
            <canvas id="spectrumCanvas"></canvas>
            <div class="analyzer-controls">
                <button id="analyzerModeBtn" class="small-btn">Spectrum</button>
                <button id="rta-mode" class="small-btn">RTA</button>
            </div>
        </section>

        <!-- EQ Section -->
        <section id="equalizer">
            <div class="eq-header">
                <h3>31-Band Equalizer</h3>
                <div class="eq-controls">
                    <button id="resetEqBtn" class="small-btn">Reset</button>
                    <select id="presetSelect">
                        <option value="flat">Flat</option>
                        <option value="bass-boost">Bass Boost</option>
                        <option value="vocal">Vocal</option>
                        <option value="rock">Rock</option>
                        <option value="jazz">Jazz</option>
                        <option value="classical">Classical</option>
                        <option value="car-sedan">Car - Sedan</option>
                        <option value="car-suv">Car - SUV</option>
                        <option value="car-truck">Car - Truck</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
            </div>
            <div id="eqBands" class="eq-bands"></div>
        </section>

        <!-- Calibration Section -->
        <section id="calibration">
            <h3>Auto Calibration</h3>
            <div class="calibration-controls">
                <button id="calibrateBtn" class="primary-btn">Start Calibration</button>
                <button id="advancedCalBtn" class="secondary-btn">Advanced Mode</button>
            </div>
            <div id="calibrationStatus" class="status-message"></div>
            <div id="advancedOptions" class="advanced-options" style="display: none;">
                <label>
                    <span>Target Curve:</span>
                    <select id="targetCurve">
                        <option value="flat">Flat Response</option>
                        <option value="harman">Harman Target</option>
                        <option value="b&k">B&K House Curve</option>
                        <option value="custom">Custom</option>
                    </select>
                </label>
                <label>
                    <span>Measurement Time:</span>
                    <input type="range" id="measureTime" min="5" max="30" value="10" step="5">
                    <span id="measureTimeValue">10s</span>
                </label>
                <label>
                    <span>Smoothing:</span>
                    <select id="smoothing">
                        <option value="1/3">1/3 Octave</option>
                        <option value="1/6">1/6 Octave</option>
                        <option value="1/12">1/12 Octave</option>
                    </select>
                </label>
            </div>
        </section>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Settings</h3>
                <div class="settings-group">
                    <label>
                        <span>EQ Type:</span>
                        <select id="eqType">
                            <option value="graphic">31-Band Graphic</option>
                            <option value="parametric">5-Band Parametric</option>
                        </select>
                    </label>
                    <label>
                        <span>Crossfade:</span>
                        <input type="checkbox" id="crossfadeEnabled">
                    </label>
                    <label>
                        <span>Limiter:</span>
                        <input type="checkbox" id="limiterEnabled" checked>
                    </label>
                    <label>
                        <span>Save Battery:</span>
                        <input type="checkbox" id="batterySaver">
                    </label>
                </div>
                <button id="closeSettingsBtn" class="primary-btn">Close</button>
            </div>
        </div>
    </div>

    <audio id="audioElement" crossorigin="anonymous"></audio>
    <script src="js/audio-processor.js"></script>
    <script src="js/spectrum-analyzer.js"></script>
    <script src="js/calibration.js"></script>
    <script src="js/app.js"></script>
</body>
</html>